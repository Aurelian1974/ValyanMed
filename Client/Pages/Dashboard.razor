@page "/dashboard"
@inject IAuthenticationStateService AuthStateService
@inject IJSRuntime JS
@inject NavigationManager Nav

<PageTitle>Dashboard - ValyanMed</PageTitle>

<RadzenStack Style="padding: 1rem; max-width: 1400px;">
    <RadzenText TextStyle="TextStyle.H3" Style="margin-bottom: 1.5rem;">Dashboard</RadzenText>
    
    @if (_currentUser != null)
    {
        <RadzenAlert AlertStyle="AlertStyle.Success" Style="margin-bottom: 1rem;">
            Bun venit, @_currentUser.NumeComplet! Sunteti conectat cu succes in sistemul ValyanMed.
        </RadzenAlert>
    }

    <RadzenRow Gap="1rem">
        <RadzenColumn SizeXS="12" SizeMD="6" SizeLG="3">
            <RadzenCard>
                <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
                    <RadzenStack>
                        <RadzenText TextStyle="TextStyle.Body2" Style="color: #666;">Pacienti inregistrati</RadzenText>
                        <RadzenText TextStyle="TextStyle.H4">1,234</RadzenText>
                    </RadzenStack>
                    <RadzenIcon Icon="people" Style="font-size: 48px; color: #1976d2;" />
                </RadzenStack>
            </RadzenCard>
        </RadzenColumn>

        <RadzenColumn SizeXS="12" SizeMD="6" SizeLG="3">
            <RadzenCard>
                <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
                    <RadzenStack>
                        <RadzenText TextStyle="TextStyle.Body2" Style="color: #666;">Consultatii Astazi</RadzenText>
                        <RadzenText TextStyle="TextStyle.H4">45</RadzenText>
                    </RadzenStack>
                    <RadzenIcon Icon="event" Style="font-size: 48px; color: #4caf50;" />
                </RadzenStack>
            </RadzenCard>
        </RadzenColumn>

        <RadzenColumn SizeXS="12" SizeMD="6" SizeLG="3">
            <RadzenCard>
                <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
                    <RadzenStack>
                        <RadzenText TextStyle="TextStyle.Body2" Style="color: #666;">Stoc Medicamente</RadzenText>
                        <RadzenText TextStyle="TextStyle.H4">892</RadzenText>
                    </RadzenStack>
                    <RadzenIcon Icon="medication" Style="font-size: 48px; color: #ff9800;" />
                </RadzenStack>
            </RadzenCard>
        </RadzenColumn>

        <RadzenColumn SizeXS="12" SizeMD="6" SizeLG="3">
            <RadzenCard>
                <RadzenStack Orientation="Orientation.Horizontal" JustifyContent="JustifyContent.SpaceBetween" AlignItems="AlignItems.Center">
                    <RadzenStack>
                        <RadzenText TextStyle="TextStyle.Body2" Style="color: #666;">Venit Luna Curenta</RadzenText>
                        <RadzenText TextStyle="TextStyle.H4">€15,450</RadzenText>
                    </RadzenStack>
                    <RadzenIcon Icon="monetization_on" Style="font-size: 48px; color: #9c27b0;" />
                </RadzenStack>
            </RadzenCard>
        </RadzenColumn>

        <RadzenColumn SizeXS="12" SizeLG="8">
            <RadzenCard>
                <RadzenText TextStyle="TextStyle.H6" Style="margin-bottom: 1rem;">Activitate Recente</RadzenText>
                <RadzenStack>
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                        <RadzenIcon Icon="person_add" Style="color: #1976d2;" />
                        <RadzenText>Pacient nou inregistrat: Maria Popescu</RadzenText>
                    </RadzenStack>
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                        <RadzenIcon Icon="event_available" Style="color: #4caf50;" />
                        <RadzenText>Consultatie programata pentru 14:30</RadzenText>
                    </RadzenStack>
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                        <RadzenIcon Icon="local_pharmacy" Style="color: #ff9800;" />
                        <RadzenText>Stoc medicament actualizat: Paracetamol</RadzenText>
                    </RadzenStack>
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                        <RadzenIcon Icon="payment" Style="color: #9c27b0;" />
                        <RadzenText>Factura generata: #FAC-2024-001</RadzenText>
                    </RadzenStack>
                    <RadzenStack Orientation="Orientation.Horizontal" AlignItems="AlignItems.Center" Gap="0.5rem">
                        <RadzenIcon Icon="assessment" Style="color: #f44336;" />
                        <RadzenText>Raport lunar generat cu succes</RadzenText>
                    </RadzenStack>
                </RadzenStack>
            </RadzenCard>
        </RadzenColumn>

        <RadzenColumn SizeXS="12" SizeLG="4">
            <RadzenCard>
                <RadzenText TextStyle="TextStyle.H6" Style="margin-bottom: 1rem;">Actiuni Rapide</RadzenText>
                <RadzenStack Gap="0.75rem">
                    <RadzenButton Variant="Variant.Filled" 
                                  ButtonStyle="ButtonStyle.Primary" 
                                  Icon="person_add"
                                  Style="width: 100%;"
                                  Click="@(() => Nav.NavigateTo("/pacienti"))">
                        Adauga Pacient
                    </RadzenButton>
                    
                    <RadzenButton Variant="Variant.Filled" 
                                  ButtonStyle="ButtonStyle.Secondary" 
                                  Icon="event"
                                  Style="width: 100%;"
                                  Click="@(() => Nav.NavigateTo("/programari"))">
                        Programeaza Consultatie
                    </RadzenButton>
                    
                    <RadzenButton Variant="Variant.Filled" 
                                  ButtonStyle="ButtonStyle.Warning" 
                                  Icon="local_pharmacy"
                                  Style="width: 100%;"
                                  Click="@(() => Nav.NavigateTo("/farmacie/medicamente"))">
                        Gestioneaza Medicamente
                    </RadzenButton>
                    
                    <RadzenButton Variant="Variant.Filled" 
                                  ButtonStyle="ButtonStyle.Success" 
                                  Icon="assessment"
                                  Style="width: 100%;"
                                  Click="@(() => Nav.NavigateTo("/rapoarte"))">
                        Vezi Rapoarte
                    </RadzenButton>
                    
                    <RadzenSeparator />
                    
                    <RadzenButton Variant="Variant.Outlined"
                                  ButtonStyle="ButtonStyle.Danger"
                                  Icon="logout"
                                  Style="width: 100%;"
                                  Click="@LogoutNow">
                        Delogare
                    </RadzenButton>
                </RadzenStack>
            </RadzenCard>
        </RadzenColumn>
    </RadzenRow>
</RadzenStack>

@code {
    private AuthenticationResponse? _currentUser;

    protected override async Task OnInitializedAsync()
    {
        _currentUser = await AuthStateService.GetCurrentUserAsync();
    }

    private async Task LogoutNow()
    {
        try
        {
            await JS.InvokeVoidAsync("appLifecycle.logoutNow", "https://localhost:7294/api/auth/logout",
                new[] { "valyanmed_auth_token", "valyanmed_user_info", "currentUser" });
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Dashboard logout error: {ex.Message}");
        }
        finally
        {
            Nav.NavigateTo("/login", forceLoad: true);
        }
    }
}
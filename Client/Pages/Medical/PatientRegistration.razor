@page "/medical/pacienti/nou"
@using global::Shared.DTOs.Medical
@using global::Shared.Validators.Medical
@using global::FluentValidation
@using MudBlazor
@inject HttpClient Http
@inject ISnackbar Snackbar
@inject NavigationManager Navigation

<PageTitle>Pacient nou - ValyanMed</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="pa-4">
    <!-- Header -->
    <MudPaper Class="pa-4 mb-4" Elevation="2">
        <MudGrid AlignItems="Center">
            <MudItem xs="12" md="8">
                <MudText Typo="Typo.h4" Color="Color.Primary">
                    <MudIcon Icon="Icons.Material.Filled.PersonAdd" Class="mr-3" />
                    Înregistrare pacient nou
                </MudText>
                <MudText Typo="Typo.body1" Color="Color.Secondary">
                    Completa?i formularul pentru a înregistra un pacient nou în sistem
                </MudText>
            </MudItem>
            <MudItem xs="12" md="4" Class="d-flex justify-end">
                <MudButton Variant="Variant.Outlined" 
                          Color="Color.Secondary" 
                          StartIcon="Icons.Material.Filled.ArrowBack"
                          OnClick="@(() => Navigation.NavigateTo("/medical/pacienti"))">
                    Înapoi la list?
                </MudButton>
            </MudItem>
        </MudGrid>
    </MudPaper>

    <!-- Form -->
    <MudForm @ref="_form" Model="_pacientRequest" Validation="_validator">
        <MudGrid>
            <!-- Informa?ii personale -->
            <MudItem xs="12">
                <MudPaper Class="pa-4 mb-4" Elevation="1">
                    <MudText Typo="Typo.h6" Color="Color.Primary" Class="mb-4">
                        <MudIcon Icon="Icons.Material.Filled.Person" Class="mr-2" />
                        Informa?ii personale
                    </MudText>
                    
                    <MudGrid>
                        <MudItem xs="12" md="6">
                            <MudTextField @bind-Value="_pacientRequest.Nume"
                                         Label="Nume *"
                                         Placeholder="Introduce?i numele"
                                         Variant="Variant.Outlined"
                                         Adornment="Adornment.Start"
                                         AdornmentIcon="Icons.Material.Filled.Person"
                                         For="@(() => _pacientRequest.Nume)"
                                         Immediate="true" />
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudTextField @bind-Value="_pacientRequest.Prenume"
                                         Label="Prenume *"
                                         Placeholder="Introduce?i prenumele"
                                         Variant="Variant.Outlined"
                                         For="@(() => _pacientRequest.Prenume)"
                                         Immediate="true" />
                        </MudItem>
                        
                        <MudItem xs="12" md="6">
                            <MudTextField @bind-Value="_pacientRequest.CNP"
                                         Label="CNP"
                                         Placeholder="1234567890123"
                                         Variant="Variant.Outlined"
                                         Adornment="Adornment.Start"
                                         AdornmentIcon="Icons.Material.Filled.Badge"
                                         For="@(() => _pacientRequest.CNP)"
                                         MaxLength="13"
                                         Immediate="true"
                                         OnKeyPress="OnCNPKeyPress" />
                        </MudItem>
                        
                        <MudItem xs="12" md="6">
                            <MudDatePicker @bind-Date="_selectedDate"
                                          Label="Data na?terii *"
                                          Variant="Variant.Outlined"
                                          MaxDate="DateTime.Today"
                                          MinDate="DateTime.Today.AddYears(-150)"
                                          Culture="@System.Globalization.CultureInfo.GetCultureInfo("ro-RO")" />
                        </MudItem>
                        
                        <MudItem xs="12" md="6">
                            <MudSelect @bind-Value="_pacientRequest.Gen"
                                      Label="Gen *"
                                      Variant="Variant.Outlined"
                                      For="@(() => _pacientRequest.Gen)"
                                      AnchorOrigin="Origin.BottomCenter">
                                <MudSelectItem Value="@("Masculin")">
                                    <div class="d-flex align-center">
                                        <MudIcon Icon="Icons.Material.Filled.Man" Class="mr-2" />
                                        Masculin
                                    </div>
                                </MudSelectItem>
                                <MudSelectItem Value="@("Feminin")">
                                    <div class="d-flex align-center">
                                        <MudIcon Icon="Icons.Material.Filled.Woman" Class="mr-2" />
                                        Feminin
                                    </div>
                                </MudSelectItem>
                                <MudSelectItem Value="@("Neprecizat")">
                                    <div class="d-flex align-center">
                                        <MudIcon Icon="Icons.Material.Filled.Person" Class="mr-2" />
                                        Neprecizat
                                    </div>
                                </MudSelectItem>
                            </MudSelect>
                        </MudItem>
                    </MudGrid>
                </MudPaper>
            </MudItem>

            <!-- Informa?ii de contact -->
            <MudItem xs="12">
                <MudPaper Class="pa-4 mb-4" Elevation="1">
                    <MudText Typo="Typo.h6" Color="Color.Primary" Class="mb-4">
                        <MudIcon Icon="Icons.Material.Filled.ContactPhone" Class="mr-2" />
                        Informa?ii de contact
                    </MudText>
                    
                    <MudGrid>
                        <MudItem xs="12" md="6">
                            <MudTextField @bind-Value="_pacientRequest.Telefon"
                                         Label="Telefon"
                                         Placeholder="0721234567"
                                         Variant="Variant.Outlined"
                                         Adornment="Adornment.Start"
                                         AdornmentIcon="Icons.Material.Filled.Phone"
                                         For="@(() => _pacientRequest.Telefon)"
                                         Immediate="true" />
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudTextField @bind-Value="_pacientRequest.Email"
                                         Label="Email"
                                         Placeholder="nume@exemplu.ro"
                                         Variant="Variant.Outlined"
                                         Adornment="Adornment.Start"
                                         AdornmentIcon="Icons.Material.Filled.Email"
                                         For="@(() => _pacientRequest.Email)"
                                         Immediate="true" />
                        </MudItem>
                    </MudGrid>
                </MudPaper>
            </MudItem>

            <!-- Adres? -->
            <MudItem xs="12">
                <MudPaper Class="pa-4 mb-4" Elevation="1">
                    <MudText Typo="Typo.h6" Color="Color.Primary" Class="mb-4">
                        <MudIcon Icon="Icons.Material.Filled.LocationOn" Class="mr-2" />
                        Adres?
                    </MudText>
                    
                    <MudGrid>
                        <MudItem xs="12">
                            <MudTextField @bind-Value="_pacientRequest.Adresa"
                                         Label="Adres? complet?"
                                         Placeholder="Strada, num?rul, etc."
                                         Variant="Variant.Outlined"
                                         Lines="2"
                                         For="@(() => _pacientRequest.Adresa)" />
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudTextField @bind-Value="_pacientRequest.Oras"
                                         Label="Ora?"
                                         Placeholder="Bucure?ti"
                                         Variant="Variant.Outlined"
                                         For="@(() => _pacientRequest.Oras)" />
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudSelect @bind-Value="_pacientRequest.Judet"
                                      Label="Jude?"
                                      Variant="Variant.Outlined"
                                      For="@(() => _pacientRequest.Judet)"
                                      Clearable="true">
                                <MudSelectItem Value="@("")">Selecta?i jude?ul</MudSelectItem>
                                <MudSelectItem Value="@("Bucuresti")">Bucure?ti</MudSelectItem>
                                <MudSelectItem Value="@("Cluj")">Cluj</MudSelectItem>
                                <MudSelectItem Value="@("Timis")">Timi?</MudSelectItem>
                                <MudSelectItem Value="@("Iasi")">Ia?i</MudSelectItem>
                                <MudSelectItem Value="@("Constanta")">Constan?a</MudSelectItem>
                                <MudSelectItem Value="@("Brasov")">Bra?ov</MudSelectItem>
                                <MudSelectItem Value="@("Dolj")">Dolj</MudSelectItem>
                                <MudSelectItem Value="@("Galati")">Gala?i</MudSelectItem>
                                <MudSelectItem Value="@("Prahova")">Prahova</MudSelectItem>
                                <MudSelectItem Value="@("Bihor")">Bihor</MudSelectItem>
                                <MudSelectItem Value="@("Sibiu")">Sibiu</MudSelectItem>
                                <MudSelectItem Value="@("Arges")">Arge?</MudSelectItem>
                                <MudSelectItem Value="@("Bacau")">Bac?u</MudSelectItem>
                                <MudSelectItem Value="@("Maramures")">Maramure?</MudSelectItem>
                                <MudSelectItem Value="@("Suceava")">Suceava</MudSelectItem>
                            </MudSelect>
                        </MudItem>
                        <MudItem xs="12" md="4">
                            <MudTextField @bind-Value="_pacientRequest.CodPostal"
                                         Label="Cod po?tal"
                                         Placeholder="012345"
                                         Variant="Variant.Outlined"
                                         For="@(() => _pacientRequest.CodPostal)"
                                         MaxLength="6" />
                        </MudItem>
                    </MudGrid>
                </MudPaper>
            </MudItem>

            <!-- Contact de urgen?? -->
            <MudItem xs="12">
                <MudPaper Class="pa-4 mb-4" Elevation="1">
                    <MudText Typo="Typo.h6" Color="Color.Primary" Class="mb-4">
                        <MudIcon Icon="Icons.Material.Filled.Emergency" Class="mr-2" />
                        Contact de urgen??
                    </MudText>
                    
                    <MudGrid>
                        <MudItem xs="12" md="6">
                            <MudTextField @bind-Value="_pacientRequest.NumeContactUrgenta"
                                         Label="Nume contact urgen??"
                                         Placeholder="Nume ?i prenume"
                                         Variant="Variant.Outlined"
                                         For="@(() => _pacientRequest.NumeContactUrgenta)" />
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudTextField @bind-Value="_pacientRequest.TelefonContactUrgenta"
                                         Label="Telefon contact urgen??"
                                         Placeholder="0721234567"
                                         Variant="Variant.Outlined"
                                         Adornment="Adornment.Start"
                                         AdornmentIcon="Icons.Material.Filled.Phone"
                                         For="@(() => _pacientRequest.TelefonContactUrgenta)" />
                        </MudItem>
                    </MudGrid>
                </MudPaper>
            </MudItem>

            <!-- Asigurare medical? -->
            <MudItem xs="12">
                <MudPaper Class="pa-4 mb-4" Elevation="1">
                    <MudText Typo="Typo.h6" Color="Color.Primary" Class="mb-4">
                        <MudIcon Icon="Icons.Material.Filled.HealthAndSafety" Class="mr-2" />
                        Asigurare medical?
                    </MudText>
                    
                    <MudGrid>
                        <MudItem xs="12" md="6">
                            <MudSelect @bind-Value="_pacientRequest.FurnizorAsigurare"
                                      Label="Furnizor asigurare"
                                      Variant="Variant.Outlined"
                                      For="@(() => _pacientRequest.FurnizorAsigurare)"
                                      Clearable="true">
                                <MudSelectItem Value="@("")">Selecta?i furnizorul</MudSelectItem>
                                <MudSelectItem Value="@("CNAS")">CNAS (Casa Na?ional? de Asigur?ri de S?n?tate)</MudSelectItem>
                                <MudSelectItem Value="@("Regina Maria")">Regina Maria</MudSelectItem>
                                <MudSelectItem Value="@("Medicover")">Medicover</MudSelectItem>
                                <MudSelectItem Value="@("Sanador")">Sanador</MudSelectItem>
                                <MudSelectItem Value="@("MedLife")">MedLife</MudSelectItem>
                                <MudSelectItem Value="@("Europ Assistance")">Europ Assistance</MudSelectItem>
                                <MudSelectItem Value="@("Fara asigurare")">F?r? asigurare</MudSelectItem>
                                <MudSelectItem Value="@("Altul")">Altul</MudSelectItem>
                            </MudSelect>
                        </MudItem>
                        <MudItem xs="12" md="6">
                            <MudTextField @bind-Value="_pacientRequest.NumarAsigurare"
                                         Label="Num?r asigurare"
                                         Placeholder="Num?rul cardului de asigurare"
                                         Variant="Variant.Outlined"
                                         For="@(() => _pacientRequest.NumarAsigurare)" />
                        </MudItem>
                    </MudGrid>
                </MudPaper>
            </MudItem>

            <!-- Action Buttons -->
            <MudItem xs="12">
                <MudPaper Class="pa-4" Elevation="2">
                    <MudGrid AlignItems="Center">
                        <MudItem xs="12" md="6">
                            <MudText Typo="Typo.body2" Color="Color.Secondary">
                                <MudIcon Icon="Icons.Material.Filled.Info" Size="Size.Small" Class="mr-1" />
                                Câmpurile marcate cu * sunt obligatorii
                            </MudText>
                        </MudItem>
                        <MudItem xs="12" md="6" Class="d-flex justify-end">
                            <MudButtonGroup Variant="Variant.Filled">
                                <MudButton Color="Color.Secondary"
                                          StartIcon="Icons.Material.Filled.Cancel"
                                          OnClick="Cancel"
                                          Disabled="_isProcessing">
                                    Anuleaz?
                                </MudButton>
                                <MudButton Color="Color.Primary"
                                          StartIcon="@(_isProcessing ? null : Icons.Material.Filled.Save)"
                                          OnClick="SavePacient"
                                          Disabled="_isProcessing">
                                    @if (_isProcessing)
                                    {
                                        <MudProgressCircular Size="Size.Small" Indeterminate="true" />
                                        <span class="ml-2">Se salveaz?...</span>
                                    }
                                    else
                                    {
                                        <span>Salveaz? pacientul</span>
                                    }
                                </MudButton>
                            </MudButtonGroup>
                        </MudItem>
                    </MudGrid>
                </MudPaper>
            </MudItem>
        </MudGrid>
    </MudForm>
</MudContainer>
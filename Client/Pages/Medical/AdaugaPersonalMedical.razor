@page "/medical/personal/nou"
@using global::Shared.DTOs.Medical
@using global::Shared.Enums.Medical
@using global::Shared.Common
@using Radzen
@using Radzen.Blazor
@using Client.Services.Medical
@using FluentValidation

<PageTitle>Adauga Personal Medical - ValyanMed</PageTitle>

<link href="~/css/pages/adauga-personal-medical.css" rel="stylesheet" />

<RadzenRow Class="rz-p-4">
    <RadzenColumn Size="12">
        
        <!-- Header Card -->
        <RadzenCard Class="rz-mb-4">
            <RadzenRow JustifyContent="Radzen.JustifyContent.SpaceBetween" AlignItems="Radzen.AlignItems.Center">
                <RadzenColumn Size="12" SizeMD="8">
                    <RadzenStack Orientation="Radzen.Orientation.Horizontal" AlignItems="Radzen.AlignItems.Center" Gap="1rem">
                        <RadzenIcon Icon="person_add" Style="font-size: 1.5rem; color: var(--rz-primary);" />
                        <RadzenText TextStyle="TextStyle.H4" Class="rz-m-0">Adauga Personal Medical Nou</RadzenText>
                    </RadzenStack>
                </RadzenColumn>
                <RadzenColumn Size="12" SizeMD="4">
                    <RadzenStack Orientation="Radzen.Orientation.Horizontal" JustifyContent="Radzen.JustifyContent.End" Gap="0.5rem">
                        <RadzenButton Text="Inapoi la lista" 
                                     Icon="arrow_back" 
                                     ButtonStyle="ButtonStyle.Light" 
                                     Variant="Radzen.Variant.Outlined"
                                     Click="@BackToList" />
                    </RadzenStack>
                </RadzenColumn>
            </RadzenRow>
        </RadzenCard>

        <!-- Form Card -->
        <RadzenCard Style="max-width: 900px; margin: 0 auto;">
            <RadzenTemplateForm TItem="CreatePersonalMedicalRequest" Data="@_model" Submit="@OnSubmitAsync">
                <DataAnnotationsValidator />
                
                <RadzenStack Gap="2rem">
                    
                    <!-- Informatii Personale -->
                    <RadzenFieldset Text="Informatii Personale">
                        <RadzenRow Gap="1rem">
                            <RadzenColumn Size="12" SizeMD="6">
                                <RadzenFormField Text="Nume" Variant="Radzen.Variant.Outlined" Class="required-field">
                                    <RadzenTextBox @bind-Value="_model.Nume" 
                                                  Placeholder="Introduceti numele..." 
                                                  MaxLength="100"
                                                  Style="width: 100%;"
                                                  Change="@(() => OnFieldChanged(nameof(_model.Nume)))" />
                                </RadzenFormField>
                                <RadzenRequiredValidator Component="Nume" Text="Numele este obligatoriu" />
                            </RadzenColumn>
                            
                            <RadzenColumn Size="12" SizeMD="6">
                                <RadzenFormField Text="Prenume" Variant="Radzen.Variant.Outlined" Class="required-field">
                                    <RadzenTextBox @bind-Value="_model.Prenume"
                                                   Class="form-control-uniform"
                                                  Placeholder="Introduceti prenumele..." 
                                                  MaxLength="100"
                                                  Style="width: 100%;"
                                                  Change="@(() => OnFieldChanged(nameof(_model.Prenume)))" />
                                </RadzenFormField>
                                <RadzenRequiredValidator Component="Prenume" Text="Prenumele este obligatoriu" />
                            </RadzenColumn>
                        </RadzenRow>

                        <RadzenRow Gap="1rem">
                            <RadzenColumn Size="12" SizeMD="6">
                                <RadzenFormField Text="Pozitie" Variant="Radzen.Variant.Outlined" Class="required-field">
                                    <RadzenDropDown @bind-Value="_model.Pozitie" 
                                                   Data="@_pozitiiOptions" 
                                                   TextProperty="Text" 
                                                   ValueProperty="Value"
                                                   Placeholder="Selecteaza pozitia..." 
                                                   AllowClear="false"
                                                   AllowFiltering="true"
                                                    Style="width: 100%; max-width: 400px;"
                                                   Change="@OnPozitieChanged" />
                                </RadzenFormField>
                                <RadzenRequiredValidator Component="Pozitie" Text="Pozitia este obligatorie" />
                            </RadzenColumn>

                            <RadzenColumn Size="12" SizeMD="6">
                                <RadzenFormField Text="Departament" Variant="Radzen.Variant.Outlined">
                                    <RadzenDropDown @bind-Value="_model.Departament" 
                                                   Data="@_departamenteOptions" 
                                                   TextProperty="Text" 
                                                   ValueProperty="Value"
                                                   Placeholder="Selecteaza departamentul..." 
                                                   AllowClear="true"
                                                   AllowFiltering="true"
                                                   Style="width: 100%;" />
                                </RadzenFormField>
                            </RadzenColumn>
                        </RadzenRow>

                        <RadzenRow Gap="1rem">
                            <RadzenColumn Size="12" SizeMD="6">
                                <RadzenFormField Text="Status" Variant="Radzen.Variant.Outlined">
                                    <RadzenStack Orientation="Radzen.Orientation.Horizontal" AlignItems="Radzen.AlignItems.Center" Gap="0.75rem" Class="rz-mt-2">
                                        <RadzenCheckBox @bind-Value="_model.EsteActiv" Name="EsteActiv" />
                                        <RadzenLabel Text="Personal activ in sistem" Component="EsteActiv" />
                                    </RadzenStack>
                                </RadzenFormField>
                            </RadzenColumn>
                        </RadzenRow>
                    </RadzenFieldset>

                    <!-- Informatii Profesionale -->
                    <RadzenFieldset Text="Informatii Profesionale">
                        <RadzenRow Gap="1rem">
                            <RadzenColumn Size="12" SizeMD="6">
                                <RadzenFormField Text="Specializare" Variant="Radzen.Variant.Outlined">
                                    <RadzenTextBox @bind-Value="_model.Specializare" 
                                                  Placeholder="Introduceti specializarea..." 
                                                  MaxLength="100"
                                                  Style="width: 100%;" />
                                </RadzenFormField>
                                @if (_showSpecializareWarning)
                                {
                                    <div class="business-warning">
                                        <RadzenIcon Icon="info" />
                                        Specializarea este recomandata pentru aceasta pozitie
                                    </div>
                                }
                            </RadzenColumn>

                            <RadzenColumn Size="12" SizeMD="6">
                                <RadzenFormField Text="Numar Licenta" Variant="Radzen.Variant.Outlined">
                                    <RadzenTextBox @bind-Value="_model.NumarLicenta" 
                                                  Placeholder="Introduceti numarul de licenta..." 
                                                  MaxLength="50"
                                                  Style="width: 100%;" />
                                </RadzenFormField>
                                @if (_showLicentaWarning)
                                {
                                    <div class="business-warning">
                                        <RadzenIcon Icon="info" />
                                        Numarul de licenta este obligatoriu pentru aceasta pozitie
                                    </div>
                                }
                            </RadzenColumn>
                        </RadzenRow>
                    </RadzenFieldset>

                    <!-- Informatii Contact -->
                    <RadzenFieldset Text="Informatii de Contact">
                        <RadzenRow Gap="1rem">
                            <RadzenColumn Size="12" SizeMD="6">
                                <RadzenFormField Text="Telefon" Variant="Radzen.Variant.Outlined">
                                    <RadzenTextBox @bind-Value="_model.Telefon" 
                                                  Placeholder="Ex: 0721123456" 
                                                  MaxLength="20"
                                                  Style="width: 100%;" />
                                </RadzenFormField>
                            </RadzenColumn>

                            <RadzenColumn Size="12" SizeMD="6">
                                <RadzenFormField Text="Email" Variant="Radzen.Variant.Outlined">
                                    <RadzenTextBox @bind-Value="_model.Email" 
                                                  Placeholder="Ex: nume@valyanmed.ro" 
                                                  MaxLength="100"
                                                  Style="width: 100%;" />
                                </RadzenFormField>
                            </RadzenColumn>
                        </RadzenRow>
                    </RadzenFieldset>

                    <!-- Action Buttons -->
                    <RadzenCard Variant="Radzen.Variant.Outlined" Class="rz-background-color-base-100">
                        <RadzenStack Orientation="Radzen.Orientation.Horizontal" JustifyContent="Radzen.JustifyContent.End" Gap="1rem">
                            <RadzenButton Text="Anuleaza" 
                                         Icon="cancel" 
                                         ButtonStyle="ButtonStyle.Danger" 
                                         Variant="Radzen.Variant.Outlined"
                                         Click="@BackToList"
                                         Disabled="@_isProcessing" />
                            <RadzenButton Text="@(_isProcessing ? "Se salveaza..." : "Salveaza Personal")" 
                                         Icon="@(_isProcessing ? "hourglass_empty" : "save")" 
                                         ButtonType="Radzen.ButtonType.Submit"
                                         ButtonStyle="ButtonStyle.Primary"
                                         Disabled="@_isProcessing"
                                         IsBusy="@_isProcessing" />
                        </RadzenStack>
                    </RadzenCard>

                </RadzenStack>
            </RadzenTemplateForm>
        </RadzenCard>
        
    </RadzenColumn>
</RadzenRow>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ValyanMed</title>
    <base href="/" />
    <link href="_content/MudBlazor/MudBlazor.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/app.css" />
    <link href="manifest.webmanifest" rel="manifest" />
    <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />
    <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png" />
    <link href="css/grid-details.css" rel="stylesheet" />

    <!-- Fonts required by MudBlazor (icons and Roboto) + robust diacritics fallback (Noto Sans) -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@300;400;500;700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet" />
</head>

<body>
    <div id="app">
        <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%" />
            <circle r="40%" cx="50%" cy="50%" />
        </svg>
        <div class="loading-progress-text"></div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="." class="reload">Reload</a>
        <span class="dismiss">ðŸ—™</span>
    </div>

    <script>
        (function () {
            function checkSessionStatus() {
                if (localStorage.getItem('authToken') && !sessionStorage.getItem('sessionActive')) {
                    console.log("Browser was closed and reopened - clearing auth");
                    clearAuthData();
                }
                sessionStorage.setItem('sessionActive', 'true');
            }
            function clearAuthData() {
                localStorage.removeItem('authToken');
                localStorage.removeItem('userName');
                localStorage.removeItem('userFullName');
                console.log("Authentication data cleared");
            }
            checkSessionStatus();
            window.authManager = { clearAuthData, checkSessionStatus };
        })();

        window.loadCSS = function (href) {
            var links = document.getElementsByTagName('link');
            for (var i = 0; i < links.length; i++) {
                if (links[i].href.indexOf(href) !== -1) return;
            }
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = href;
            document.head.appendChild(link);
        };

        window.appInterop = {
            sayHello: function (name) { return "Hello, " + name; },
            logout: function () { window.authManager.clearAuthData(); return true; }
        };

        window.appFunctions = {
            test: function () { return "JS interop is working!"; }
        };
    </script>

    <!-- MudBlazor -->
    <script src="_content/MudBlazor/MudBlazor.min.js"></script>

    <!-- Helpers (file utils, localStorage wrappers) -->
    <script src="js/fileUtils.js"></script>

    <!-- Blazor Framework -->
    <script src="_framework/blazor.webassembly.js"></script>

    <!-- Service Worker -->
    <script>navigator.serviceWorker.register('service-worker.js');</script>
</body>

</html>
@inherits LayoutComponentBase
@using Microsoft.AspNetCore.Components.Authorization
@using Radzen
@using Radzen.Blazor
@using System.ComponentModel

<RadzenLayout>
    <!-- Header Bar -->
    <RadzenHeader>
        <div class="professional-header">
            <!-- Left Side - Logo & Breadcrumbs -->
            <div class="header-left">
                <div class="app-logo">
                    <RadzenIcon Icon="local_hospital" Style="font-size: 24px; color: white;" />
                    <RadzenText TextStyle="TextStyle.H6" Style="color: white; font-weight: 600; margin: 0;">ValyanMed</RadzenText>
                </div>
                <!-- Breadcrumbs -->
                <div class="breadcrumbs-container">
                    <RadzenBreadCrumb>
                        <RadzenBreadCrumbItem Path="/" Text="Acasă" Icon="home" />
                        @if (!string.IsNullOrEmpty(parentPageTitle))
                        {
                            <RadzenBreadCrumbItem Path="@parentPagePath" Text="@parentPageTitle" Icon="people" />
                        }
                        <RadzenBreadCrumbItem Path="@currentPagePath" Text="@currentPageTitle" Icon="@currentPageIcon" />
                    </RadzenBreadCrumb>
                </div>
            </div>

            <!-- Center - Empty space for future features -->
            <div class="header-center">
                <!-- Future: Global search will go here -->
            </div>

            <!-- Right Side - User Actions -->
            <div class="header-right">
                <!-- User Profile - Custom Circle Avatar with Dropdown -->
                <div class="user-profile-section" style="background: rgba(255,255,255,0.08) !important; border: 1px solid rgba(255,255,255,0.15) !important; box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;">
                    <div class="user-info">
                        <RadzenText TextStyle="TextStyle.Body2" Class="user-name">@userDisplayName</RadzenText>
                        <RadzenText TextStyle="TextStyle.Caption" Class="user-role">@userRole</RadzenText>
                    </div>
                    
                    <!-- Simple Circle Avatar -->
                    <div class="user-avatar-circle" @onclick="@OnAvatarClick" @onclick:stopPropagation="true">
                        <span class="user-initials">@GetUserInitials()</span>
                    </div>
                </div>
            </div>
        </div>
    </RadzenHeader>

    <!-- Main Content with resizable left pane (Splitter) -->
    <RadzenBody>
        <RadzenSplitter Orientation="Orientation.Horizontal" Style="height: 100%; min-height: calc(100vh - 64px);">
            <!-- Left Pane: Sidebar/Menu - resizable and auto (percent) sized -->
            <RadzenSplitterPane Size="20%" Min="220px" Max="420px" Resizable="true" Collapsible="true" Scrollable="true">
                <div class="sidebar-header">
                    <RadzenText TextStyle="TextStyle.H6" Class="sidebar-title">ValyanMed</RadzenText>
                </div>

                <RadzenPanelMenu Style="width: 100%;" Class="valyan-menu">
                    <ChildContent>
                        @foreach (var item in menuData)
                        {
                            <RadzenPanelMenuItem Text="@item.Text" Icon="@item.Icon" @bind-Expanded="@item.Expanded" Path="@item.Path" Click="@item.Click">
                                <ChildContent>
                                    @if (item.Items.Any())
                                    {
                                        <div class="menu-level-1" style="margin-left: 24px;">
                                            @foreach (var subItem in item.Items)
                                            {
                                                <RadzenPanelMenuItem Text="@subItem.Text" Icon="@subItem.Icon" @bind-Expanded="@subItem.Expanded" Path="@subItem.Path" Click="@subItem.Click">
                                                    <ChildContent>
                                                        @if (subItem.Items.Any())
                                                        {
                                                            <div class="menu-level-2" style="margin-left: 24px;">
                                                                @foreach (var subSubItem in subItem.Items)
                                                                {
                                                                    <RadzenPanelMenuItem Text="@subSubItem.Text" Icon="@subSubItem.Icon" Path="@subSubItem.Path" Click="@subSubItem.Click" />
                                                                }
                                                            </div>
                                                        }
                                                    </ChildContent>
                                                </RadzenPanelMenuItem>
                                            }
                                        </div>
                                    }
                                </ChildContent>
                            </RadzenPanelMenuItem>
                        }
                    </ChildContent>
                </RadzenPanelMenu>
            </RadzenSplitterPane>

            <!-- Right Pane: Page body -->
            <RadzenSplitterPane>
                <div style="width: 100%; height: 100%; margin: 0; padding: 0;">
                    @Body
                </div>
            </RadzenSplitterPane>
        </RadzenSplitter>
    </RadzenBody>
</RadzenLayout>

<!-- Dropdown OUTSIDE RadzenLayout -->
@if (showUserMenu)
{
    <div class="user-dropdown-menu-external">
        <div class="dropdown-overlay" @onclick="@CloseUserMenu"></div>
        <div class="dropdown-content-external">
            <div class="dropdown-item" @onclick="@NavigateToProfile">
                <RadzenIcon Icon="account_circle" Style="margin-right: 8px;" />
                Profil
            </div>
            <div class="dropdown-item" @onclick="@NavigateToSettings">
                <RadzenIcon Icon="settings" Style="margin-right: 8px;" />
                Setări
            </div>
            <div class="dropdown-item" @onclick="@NavigateToPreferences">
                <RadzenIcon Icon="tune" Style="margin-right: 8px;" />
                Preferințe
            </div>
            <div class="dropdown-separator"></div>
            <div class="dropdown-item" @onclick="@NavigateToHelp">
                <RadzenIcon Icon="help" Style="margin-right: 8px;" />
                Ajutor
            </div>
            <div class="dropdown-item logout-item" @onclick="@Logout">
                <RadzenIcon Icon="logout" Style="margin-right: 8px;" />
                Delogare
            </div>
        </div>
    </div>
}

<style>
    /* PROFESSIONAL HEADER STYLES */
    .professional-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 24px;
        height: 64px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        box-shadow: 0 2px 12px rgba(0,0,0,0.1);
        position: relative;
        z-index: 10;
        margin-left: 0;
    }

    .header-left {
        display: flex;
        align-items: center;
        gap: 24px;
        flex: 0 0 auto;
        min-width: 0;
    }

    .header-center {
        display: flex;
        align-items: center;
        flex: 1;
        justify-content: center;
        margin: 0 16px;
        min-width: 0;
    }

    .header-right {
        display: flex;
        align-items: center;
        gap: 12px;
        flex: 0 0 auto;
        min-width: 0;
        justify-content: flex-end;
    }

    /* LOGO STYLING */
    .app-logo {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 6px 12px;
        background: rgba(255,255,255,0.1);
        border-radius: 8px;
        backdrop-filter: blur(10px);
        white-space: nowrap;
    }

    .logo-icon {
        color: white !important;
        font-size: 24px !important;
    }

    .logo-text {
        color: white !important;
        font-weight: 600 !important;
        font-size: 18px !important;
        margin: 0 !important;
    }

    /* BREADCRUMBS */
    .breadcrumbs-container {
        background: rgba(255,255,255,0.15);
        border-radius: 6px;
        padding: 6px 12px;
        white-space: nowrap;
    }

    /* SEARCH BAR - Made more compact */
    .global-search {
        display: flex;
        align-items: center;
        gap: 4px;
        background: rgba(255,255,255,0.95);
        border-radius: 20px;
        padding: 2px 2px 2px 12px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        max-width: 350px;
        width: 100%;
    }

    .search-input {
        border: none !important;
        background: transparent !important;
        font-size: 14px;
        width: 100%;
        min-width: 200px;
    }

    .search-button {
        border-radius: 18px !important;
        min-width: 36px !important;
        height: 36px !important;
        padding: 0 !important;
    }

    /* NOTIFICATIONS - More compact */
    .notification-btn {
        position: relative;
        color: white !important;
        border-radius: 50% !important;
        width: 40px !important;
        height: 40px !important;
        background: rgba(255,255,255,0.1) !important;
        padding: 0 !important;
        min-width: 40px !important;
    }

    .notification-btn:hover {
        background: rgba(255,255,255,0.2) !important;
    }

    /* USER PROFILE - Integrated with header styling */
    .user-profile-section {
        display: flex;
        align-items: center;
        gap: 8px;
        background: rgba(255,255,255,0.08);
        border: 1px solid rgba(255,255,255,0.15);
        border-radius: 20px;
        padding: 6px 6px 6px 12px;
        backdrop-filter: blur(10px);
        white-space: nowrap;
        min-width: auto;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
    }

    .user-profile-section:hover {
        background: rgba(255,255,255,0.12);
        border-color: rgba(255,255,255,0.25);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .user-info {
        display: flex;
        flex-direction: column;
        align-items: flex-end;
        min-width: 0;
    }

    .user-name {
        color: white !important;
        font-weight: 600 !important;
        font-size: 13px !important;
        margin: 0 !important;
        line-height: 1.2;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        max-width: 120px;
    }

    .user-role {
        color: rgba(255,255,255,0.8) !important;
        font-size: 11px !important;
        margin: 0 !important;
        line-height: 1.2;
        white-space: nowrap;
    }

    /* THEME TOGGLE - More compact */
    .theme-toggle {
        color: white !important;
        border-radius: 50% !important;
        width: 40px !important;
        height: 40px !important;
        background: rgba(255,255,255,0.1) !important;
        padding: 0 !important;
        min-width: 40px !important;
    }

    .theme-toggle:hover {
        background: rgba(255,255,255,0.2) !important;
    }

    /* CUSTOM CIRCLE AVATAR */
    .user-avatar-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        border: 2px solid rgba(255,255,255,0.3);
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        position: relative;
    }

    .user-avatar-circle:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        border-color: rgba(255,255,255,0.5);
    }

    .user-initials {
        color: white;
        font-weight: 700;
        font-size: 14px;
        letter-spacing: 0.5px;
        text-shadow: 0 1px 2px rgba(0,0,0,0.2);
    }

    /* USER DROPDOWN MENU - CLEANED UP */
    .dropdown-item {
        display: flex;
        align-items: center;
        padding: 12px 16px;
        color: #333;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 14px;
        border: none;
        background: transparent;
    }

    .dropdown-item:hover {
        background-color: #f8f9fa;
        color: #007bff;
    }

    .dropdown-item.logout-item {
        color: #dc3545;
        border-top: 1px solid #e9ecef;
    }

    .dropdown-item.logout-item:hover {
        background-color: #f8d7da;
        color: #721c24;
    }

    .dropdown-separator {
        height: 1px;
        background-color: #e9ecef;
        margin: 4px 0;
    }

    /* EXTERNAL DROPDOWN - Outside RadzenLayout */
    .user-dropdown-menu-external {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: 99999 !important;
        pointer-events: none;
    }

    .dropdown-overlay {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.05);
        pointer-events: all;
    }

    .dropdown-content-external {
        position: fixed !important;
        top: 70px !important;
        right: 24px !important;
        background: white !important;
        border-radius: 12px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.15) !important;
        border: 1px solid rgba(0,0,0,0.1) !important;
        min-width: 200px;
        overflow: hidden;
        z-index: 100000 !important;
        pointer-events: all;
        display: block !important;
        visibility: visible !important;
        opacity: 0;
        transform: translateY(-10px) scale(0.95);
        transition: all 0.2s ease-out;
    }

    .user-dropdown-menu-external .dropdown-content-external {
        opacity: 1;
        transform: translateY(0) scale(1);
    }

    /* RESPONSIVE DESIGN */
    @@media (max-width: 1200px) {
        .header-left {
            gap: 16px;
        }
        
        .breadcrumbs-container {
            display: none;
        }
        
        .global-search {
            max-width: 250px;
        }
        
        .search-input {
            min-width: 150px;
        }
        
        .user-info {
            display: none;
        }
        
        .quick-actions-btn-flat {
            min-width: 120px !important;
            padding: 10px 16px !important;
            font-size: 13px !important;
        }
    }

    @@media (max-width: 768px) {
        .professional-header {
            padding: 0 12px;
            gap: 8px;
        }
        
        .header-left {
            gap: 8px;
        }
        
        .global-search {
            max-width: 200px;
        }
        
        .search-input {
            min-width: 120px;
        }
        
        .header-right {
            gap: 8px;
        }
        
        .logo-text {
            display: none;
        }
        
        .quick-actions-btn-flat {
            min-width: 80px !important;
            padding: 8px 12px !important;
            font-size: 12px !important;
        }
        
        .quick-actions-btn-flat .rz-button-text {
            display: none;
        }
    }

    /* Layout/Body height to allow splitter to fill space */
    .rz-body {
        margin: 0 !important;
        padding: 0 !important;
        width: 100% !important;
        height: calc(100vh - 64px);
    }

    /* Ensure full width content without gaps */
    .rz-layout .rz-body {
        margin-left: 0 !important;
        margin-right: 0 !important;
    }

    /* BACKUP CSS INLINE pentru a asigura indentarea */
    .valyan-menu .menu-level-1 {
        margin-left: 24px !important;
    }
    
    .valyan-menu .menu-level-2 {
        margin-left: 24px !important;
    }
    
    /* CSS redundant pentru siguranță */
    .valyan-menu .rz-panel-menu-item .rz-panel-menu-item {
        margin-left: 24px !important;
    }
    
    .valyan-menu .rz-panel-menu-item .rz-panel-menu-item .rz-panel-menu-item {
        margin-left: 48px !important;
    }
</style>

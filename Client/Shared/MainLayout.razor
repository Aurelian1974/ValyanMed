@inherits LayoutComponentBase
@using Microsoft.AspNetCore.Components.Authorization
@using Radzen
@using Radzen.Blazor
@using System.ComponentModel

<MudThemeProvider />
<MudDialogProvider />
<MudSnackbarProvider />
<MudPopoverProvider />

<RadzenLayout>
    <!-- Header Bar -->
    <RadzenHeader>
        <MudAppBar Elevation="1" Color="MudColor.Primary" Dense="true">
            <div class="app-logo">
                <MudIcon Icon="@Icons.Material.Filled.LocalHospital" Size="Size.Medium" />
                <MudText Typo="Typo.h6">ValyanMed</MudText>
            </div>
            <MudSpacer />
            
            <!-- User menu and logout -->
            <MudMenu Color="MudColor.Inherit" Icon="@Icons.Material.Filled.AccountCircle" Dense="true" AnchorOrigin="Origin.TopRight" TransformOrigin="Origin.TopRight">
                <MudMenuItem Href="/profil" Icon="@Icons.Material.Filled.ManageAccounts">Profil</MudMenuItem>
                <MudMenuItem OnClick="Logout" Icon="@Icons.Material.Filled.Logout">Delogare</MudMenuItem>
            </MudMenu>

            <MudButton 
                OnClick="Logout" 
                StartIcon="@Icons.Material.Filled.Logout" 
                Color="MudColor.Inherit" 
                Class="ml-2" 
                Variant="MudVariant.Text">
                Delogare
            </MudButton>
        </MudAppBar>
    </RadzenHeader>

    <!-- Left Sidebar -->
    <RadzenSidebar Style="width: 280px;">
        <div class="sidebar-header">
            <RadzenText TextStyle="TextStyle.H6" Class="sidebar-title">ValyanMed</RadzenText>
        </div>
        
        <RadzenPanelMenu Style="width: 100%;" Class="valyan-menu">
            <ChildContent>
                @foreach (var item in menuData)
                {
                    <RadzenPanelMenuItem Text="@item.Text" Icon="@item.Icon" @bind-Expanded="@item.Expanded" Path="@item.Path" Click="@item.Click">
                        <ChildContent>
                            @if (item.Items.Any())
                            {
                                <div class="menu-level-1" style="margin-left: 24px;">
                                    @foreach (var subItem in item.Items)
                                    {
                                        <RadzenPanelMenuItem Text="@subItem.Text" Icon="@subItem.Icon" @bind-Expanded="@subItem.Expanded" Path="@subItem.Path" Click="@subItem.Click">
                                            <ChildContent>
                                                @if (subItem.Items.Any())
                                                {
                                                    <div class="menu-level-2" style="margin-left: 24px;">
                                                        @foreach (var subSubItem in subItem.Items)
                                                        {
                                                            <RadzenPanelMenuItem Text="@subSubItem.Text" Icon="@subSubItem.Icon" Path="@subSubItem.Path" Click="@subSubItem.Click" />
                                                        }
                                                    </div>
                                                }
                                            </ChildContent>
                                        </RadzenPanelMenuItem>
                                    }
                                </div>
                            }
                        </ChildContent>
                    </RadzenPanelMenuItem>
                }
            </ChildContent>
        </RadzenPanelMenu>
    </RadzenSidebar>

    <!-- Main Content -->
    <RadzenBody>
        <MudContainer MaxWidth="MaxWidth.ExtraLarge">
            @Body
        </MudContainer>
    </RadzenBody>
</RadzenLayout>

<style>
    /* BACKUP CSS INLINE pentru a asigura indentarea */
    .valyan-menu .menu-level-1 {
        margin-left: 24px !important;
    }
    
    .valyan-menu .menu-level-2 {
        margin-left: 24px !important;
    }
    
    /* CSS redundant pentru siguranță */
    .valyan-menu .rz-panel-menu-item .rz-panel-menu-item {
        margin-left: 24px !important;
    }
    
    .valyan-menu .rz-panel-menu-item .rz-panel-menu-item .rz-panel-menu-item {
        margin-left: 48px !important;
    }
</style>
